# 7.2 快速开始

> 五分钟启动你的第一个 AgentX 应用

本节将带你快速体验 AgentX，从安装到运行第一个智能体应用。

---

## 7.2.1 环境准备

### 系统要求

| 要求 | 说明 |
|-----|------|
| **Node.js** | 20.0 或更高版本 |
| **包管理器** | npm、yarn 或 pnpm |
| **API Key** | Anthropic Claude API Key |

### 获取 API Key

1. 访问 [Anthropic Console](https://console.anthropic.com/)
2. 注册或登录账号
3. 在 API Keys 页面创建新的 Key
4. 保存 Key（只显示一次）

---

## 7.2.2 方式一：NPX 快速体验

最简单的方式，无需安装：

```bash
# 设置 API Key
export ANTHROPIC_API_KEY=sk-ant-xxx

# 启动 Portagent
npx @agentxjs/portagent
```

启动后访问 `http://localhost:5200`，即可开始对话。

### Portagent 特性

Portagent 是 AgentX 的开箱即用门户应用：

| 特性 | 说明 |
|-----|------|
| **多用户支持** | 每个用户独立会话 |
| **会话持久化** | SQLite 存储对话历史 |
| **实时流式** | WebSocket 实时通信 |
| **MCP 支持** | 可配置工具服务器 |

---

## 7.2.3 方式二：Docker 部署

适合生产环境：

```bash
# 基础启动
docker run -d \
  -e ANTHROPIC_API_KEY=sk-ant-xxx \
  -p 5200:5200 \
  agentxjs/portagent

# 带持久化存储
docker run -d \
  -e ANTHROPIC_API_KEY=sk-ant-xxx \
  -v agentx-data:/app/data \
  -p 5200:5200 \
  agentxjs/portagent

# 带邀请码保护
docker run -d \
  -e ANTHROPIC_API_KEY=sk-ant-xxx \
  -e INVITE_CODE=your-secret-code \
  -p 5200:5200 \
  agentxjs/portagent
```

### 环境变量

| 变量 | 必需 | 说明 |
|-----|------|------|
| `ANTHROPIC_API_KEY` | 是 | Claude API Key |
| `INVITE_CODE` | 否 | 访问邀请码 |
| `PORT` | 否 | 服务端口（默认 5200） |

---

## 7.2.4 方式三：项目集成

在你的项目中使用 AgentX：

### 安装依赖

```bash
# 核心包
pnpm add @agentxjs/agent @agentxjs/runtime

# 可选：类型定义
pnpm add -D @agentxjs/types
```

### 创建第一个智能体

```typescript
// agent.ts
import { createAgent, MemoryDriver } from '@agentxjs/runtime'

async function main() {
  // 创建智能体实例
  const agent = await createAgent({
    // LLM 配置
    model: 'claude-sonnet-4-20250514',
    apiKey: process.env.ANTHROPIC_API_KEY,

    // 持久化配置（可选）
    persistence: new MemoryDriver(),

    // 系统提示词（可选）
    systemPrompt: '你是一个友好的 AI 助手。'
  })

  // 发送消息并获取响应
  const response = await agent.chat('你好！')
  console.log(response)

  // 流式响应
  for await (const chunk of agent.stream('给我讲个笑话')) {
    process.stdout.write(chunk)
  }
}

main()
```

### 运行

```bash
# 设置环境变量
export ANTHROPIC_API_KEY=sk-ant-xxx

# 运行
npx tsx agent.ts
```

---

## 7.2.5 事件监听示例

AgentX 的核心优势是事件驱动，让我们看看如何监听事件：

```typescript
import { createAgent } from '@agentxjs/runtime'

async function main() {
  const agent = await createAgent({
    model: 'claude-sonnet-4-20250514',
    apiKey: process.env.ANTHROPIC_API_KEY
  })

  // 监听思考开始
  agent.on('thinking_start', () => {
    console.log('🤔 AI 正在思考...')
  })

  // 监听文本流
  agent.on('text_delta', (event) => {
    process.stdout.write(event.delta)
  })

  // 监听思考结束
  agent.on('thinking_end', (event) => {
    console.log(`\n✅ 思考完成，耗时 ${event.duration}ms`)
  })

  // 监听工具调用
  agent.on('tool_start', (event) => {
    console.log(`🔧 调用工具: ${event.name}`)
  })

  agent.on('tool_end', (event) => {
    console.log(`📦 工具返回: ${JSON.stringify(event.output)}`)
  })

  // 监听完整消息
  agent.on('message_complete', (event) => {
    console.log(`📝 消息 ID: ${event.id}`)
  })

  // 发送消息
  await agent.chat('今天天气怎么样？')
}

main()
```

---

## 7.2.6 配置 MCP 工具

AgentX 支持 MCP（Model Context Protocol）工具：

```typescript
import { createAgent } from '@agentxjs/runtime'

const agent = await createAgent({
  model: 'claude-sonnet-4-20250514',
  apiKey: process.env.ANTHROPIC_API_KEY,

  // 配置 MCP 服务器
  mcpServers: [
    {
      name: 'filesystem',
      command: 'npx',
      args: ['-y', '@anthropic-ai/mcp-server-filesystem', '/path/to/dir']
    },
    {
      name: 'web-search',
      command: 'npx',
      args: ['-y', '@anthropic-ai/mcp-server-fetch']
    }
  ]
})

// 现在 AI 可以使用这些工具了
await agent.chat('帮我读取 README.md 文件的内容')
```

---

## 7.2.7 与 PromptX 集成

AgentX 可以与 PromptX 无缝集成：

```typescript
import { createAgent } from '@agentxjs/runtime'

const agent = await createAgent({
  model: 'claude-sonnet-4-20250514',
  apiKey: process.env.ANTHROPIC_API_KEY,

  // 配置 PromptX MCP 服务器
  mcpServers: [
    {
      name: 'promptx',
      command: 'npx',
      args: ['-y', '@anthropic-ai/mcp-server-promptx']
    }
  ]
})

// 激活角色
await agent.chat('使用 action 工具激活 writer 角色')

// 使用角色能力
await agent.chat('帮我写一篇关于 AI 的文章')
```

---

## 7.2.8 项目结构建议

对于较大的项目，建议使用以下结构：

```
my-agent-app/
├── src/
│   ├── agent/
│   │   ├── config.ts      # 智能体配置
│   │   ├── events.ts      # 事件处理器
│   │   └── index.ts       # 导出
│   ├── tools/
│   │   ├── search.ts      # 自定义工具
│   │   └── index.ts
│   └── main.ts            # 入口文件
├── .env                   # 环境变量
├── package.json
└── tsconfig.json
```

### 配置文件示例

```typescript
// src/agent/config.ts
export const agentConfig = {
  model: 'claude-sonnet-4-20250514',
  systemPrompt: `你是一个专业的 AI 助手。

你的特点：
- 回答准确、简洁
- 必要时使用工具
- 保持友好的对话风格
`,
  mcpServers: [
    // MCP 服务器配置
  ]
}
```

```typescript
// src/agent/events.ts
import type { Agent } from '@agentxjs/runtime'

export function setupEventHandlers(agent: Agent) {
  agent.on('thinking_start', () => {
    console.log('🤔 思考中...')
  })

  agent.on('error', (error) => {
    console.error('❌ 错误:', error.message)
  })

  // 更多事件处理...
}
```

---

## 本节要点

1. **三种启动方式**：NPX 快速体验、Docker 生产部署、项目集成
2. **Portagent**：开箱即用的智能体门户应用
3. **事件监听**：通过 `agent.on()` 监听各类事件
4. **MCP 集成**：通过配置 mcpServers 添加工具能力
5. **PromptX 集成**：通过 PromptX MCP 服务器激活角色

---

## 下一步

现在你已经成功运行了第一个 AgentX 应用。下一节我们将深入了解 AgentX 的核心概念，包括 AgentEngine、SystemBus 等关键组件。

---

[上一节：AgentX 简介与设计哲学](7.1-AgentX简介与设计哲学.md) | [下一节：核心概念](7.3-核心概念.md)
