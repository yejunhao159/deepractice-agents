# 1.2 智能体的构成与运行原理

在上一节中，我们了解了智能体的定义、演进历程和分类体系。本节将深入探讨智能体的内部运作机制：它是如何感知环境、做出��策、执行行动的？

---

## 1.2.1 任务环境（PEAS 模型）

要理解智能体的运作，我们必须先理解它所处的**任务环境**。在人工智能领域，通常使用 **PEAS 模型**来精确描述一个任务环境：

| 维度 | 含义 | 说明 |
|------|------|------|
| **P**erformance | 性能度量 | 如何评估智能体的表现？ |
| **E**nvironment | 环境 | 智能体所处的外部世界 |
| **A**ctuators | 执行器 | 智能体可以采取哪些行动？ |
| **S**ensors | 传感器 | 智能体如何感知环境？ |

以我们之前提到的智能旅行助手为例，下表展示了如何运用 PEAS 模型对其任务环境进行规约：

<div align="center">
  <p>表 1.2 智能旅行助手的 PEAS 描述</p>
  <img src="https://raw.githubusercontent.com/datawhalechina/Hello-Agents/main/docs/images/1-figures/1757242319667-6.png" alt="图片描述" width="90%"/>
</div>

### 环境的关键特性

在实践中，LLM 智能体所处的数字环境展现出若干复杂特性，这些特性直接影响着智能体的设计：

#### 1. 部分可观察性

环境通常是**部分可观察的**。例如，旅行助手在查询航班时，无法一次性获取所有航空公司的全部实时座位信息。它只能通过调用航班预订 API，看到该 API 返回的部分数据。

**设计启示**：智能体必须具备记忆（记住已查询过的航线）和探索（尝试不同的查询日期）的能力。

#### 2. 随机性

行动的结果并非总是确定的。旅行助手的任务环境就是典型的**随机性环境**——当它搜索票价时，两次相邻的调用返回的机票价格和余票数量都可能不同。

**设计启示**：智能体必须具备处理不确定性、监控变化并及时决策的能力。

#### 3. 多智能体性

环境中还可能存在其他行动者，从而形成**多智能体（Multi-agent）**环境。对于旅行助手而言：
- 其他用户的预订行为
- 其他自动化脚本
- 航司的动态调价系统

这些都是环境中的其他"智能体"，它们的行动（例如订走最后一张特价票）会直接改变旅行助手所处环境的状态。

**设计启示**：对智能体的快速响应和策略选择提出更高要求。

#### 4. 序贯性与动态性

几乎所有任务都发生在**序贯**且**动态**的环境中：
- **序贯**：当前动作会影响未来
- **动态**：环境自身可能在智能体决策时发生变化

**设计启示**：智能体的"感知-思考-行动-观察"循环必须能够快速、灵活地适应持续变化的世界。

---

## 1.2.2 智能体循环（Agent Loop）

在定义了智能体所处的任务环境后，我们来探讨其核心的运行机制。智能体并非一次性完成任务，而是通过一个持续的循环与环境进行交互，这个核心机制被称为**智能体循环（Agent Loop）**。

如图 1.5 所示，该循环描述了智能体与环境之间的动态交互过程，构成了其自主行为的基础。

<div align="center">
  <img src="https://raw.githubusercontent.com/datawhalechina/Hello-Agents/main/docs/images/1-figures/1757242319667-5.png" alt="图片描述" width="90%"/>
  <p>图 1.5 智能体与环境交互的基本循环</p>
</div>

这个循环主要包含以下几个相互关联的阶段：

### 阶段一：感知 (Perception)

这是循环的起点。智能体通过其传感器（例如 API 的监听端口、用户输入接口）接收来自环境的输入信息。这些信息，即**观察（Observation）**，既可以是用户的初始指令，也可以是上一步行动所导致的环境状态变化反馈。

```
输入示例：
- 用户消息："帮我查一下北京明天的天气"
- API 返回："北京明天晴，最高温度 25°C"
- 系统提示："文件已保存成功"
```

### 阶段二：思考 (Thought)

接收到观察信息后，智能体进入其核心决策阶段。对于 LLM 智能体而言，这通常是由大语言模型驱动的内部推理过程。

"思考"阶段可进一步细分为两个关键环节：

#### 规划 (Planning)
智能体基于当前的观察和其内部记忆，更新对任务和环境的理解，并制定或调整一个行动计划。这可能涉及将复杂目标分解为一系列更具体的子任务。

#### 工具选择 (Tool Selection)
根据当前计划，智能体从其可用的工具库中，选择最适合执行下一步骤的工具，并确定调用该工具所需的具体参数。

### 阶段三：行动 (Action)

决策完成后，智能体通过其执行器（Actuators）执行具体的行动。这通常表现为调用一个选定的工具（如代码解释器、搜索引擎 API），从而对环境施加影响，意图改变环境的状态。

```
行动示例：
- 调用天气 API：get_weather("北京")
- 执行代码：python run_script.py
- 发送消息：send_email(to="user@example.com", content="...")
```

### 循环闭合

行动并非循环的终点。智能体的行动会引起**环境（Environment）**的**状态变化（State Change）**，环境随即会产生一个新的**观察（Observation）**作为结果反馈。

这个新的观察又会在下一轮循环中被智能体的感知系统捕获，形成一个持续的"感知-思考-行动-观察"的闭环。智能体正是通过不断重复这一循环，逐步推进任务，从初始状态向目标状态演进。

---

## 1.2.3 Thought-Action-Observation 协议

在工程实践中，为了让 LLM 能够有效驱动智能体循环，我们需要一套明确的**交互协议（Interaction Protocol）**来规范其与环境之间的信息交换。

### 结构化输出格式

在许多现代智能体框架中，这一协议体现在对智能体每一次输出的结构化定义上。智能体的输出不再是单一的自然语言回复，而是一段遵循特定格式的文本，其中明确地展示了其内部的推理过程与最终决策。

这个结构通常包含两个核心部分：

| 部分 | 作用 | 说明 |
|------|------|------|
| **Thought** | 思考 | 智能体内部决策的"快照"，阐述如何分析当前情境、规划下一步行动 |
| **Action** | 行动 | 智能体决定对环境施加的具体操作，通常以函数调用形式表示 |

### 示例：旅行助手的输出

```bash
Thought: 用户想知道北京的天气。我需要调用天气查询工具。
Action: get_weather("北京")
```

这里的 `Action` 字段构成了对外部世界的指令。一个外部的**解析器（Parser）**会捕捉到这个指令，并调用相应的 `get_weather` 函数。

### 观察的生成

行动执行后，环境会返回一个结果。例如，`get_weather` 函数可能返回一个包含详细天气数据的 JSON 对象：

```json
{
  "city": "北京",
  "weather": "晴",
  "temperature": "25",
  "wind": "微风"
}
```

然而，原始的机器可读数据（如 JSON）通常包含 LLM 无需关注的冗余信息，且格式不符合其自然语言处理的习惯。

因此，感知系统的一个重要职责就是扮演**传感器**的角色：将这个原始输出处理并封装成一段简洁、清晰的自然语言文本，即**观察**：

```bash
Observation: 北京当前天气为晴，气温25摄氏度，微风。
```

这段 `Observation` 文本会被反馈给智能体，作为下一轮循环的主要输入信息，供其进行新一轮的 `Thought` 和 `Action`。

### 完整的交互流程

```
用户输入: 帮我查一下北京的天气，然后推荐一个景点

--- 循环 1 ---
Thought: 用户需要两个信息：天气和景点推荐。我应该先查询天气。
Action: get_weather(city="北京")
Observation: 北京当前天气为晴，气温25摄氏度。

--- 循环 2 ---
Thought: 天气是晴天，适合户外活动。现在我需要推荐一个适合晴天的景点。
Action: get_attraction(city="北京", weather="晴")
Observation: 推荐颐和园，适合在晴天游览湖景和古建筑。

--- 循环 3 ---
Thought: 我已经收集到了天气信息和景点推荐，可以给用户一个完整的回答了。
Action: finish(answer="北京今天天气晴朗，气温25度，非常适合出游。推荐您去颐和园...")
```

通过这个由 Thought、Action、Observation 构成的严谨循环，LLM 智能体得以将内部的语言推理能力，与外部环境的真实信息和工具操作能力有效地结合起来。

---

## 本节小结

本节我们学习了智能体运行的核心机制：

1. **PEAS 模型**：用于描述任务环境的四个维度（性能、环境、执行器、传感器）
2. **环境特性**：部分可观察、随机性、多智能体、序贯动态
3. **智能体循环**：感知 → 思考 → 行动 → 观察的闭环
4. **TAO 协议**：Thought-Action-Observation 的结构化交互格式

理解了这些原理后，下一节我们将动手实践，构建一个真正可运行的智能体！

---

[⬅️ 上一节：什么是智能体](1.1-什么是智能体.md) | [🏠 返回目录](README.md) | [➡️ 下一节：构建第一个智能体](1.3-构建第一个智能体.md)
