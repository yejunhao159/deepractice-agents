# 1.3 动手实践：构建你的第一个智能体

在前面的小节，我们学习了智能体的任务环境、核心运行机制以及 `Thought-Action-Observation` 交互范式。理论知识固然重要，但最好的学习方式是亲手实践。

在本节中，我们将引导你理解如何构建一个可以工作的**智能旅行助手**。但与传统教程不同，我们不会让你从零手写每一行代码——

> **🎯 核心理念：Chat is All You Need**
>
> 在 AI 时代，你不需要成为某种编程语言的专家才能构建智能体。你需要的是：
> 1. **理解原理**：知道智能体是如何工作的
> 2. **描述需求**：用自然语言清晰表达你想要什么
> 3. **与 AI 协作**：让 AI 帮你生成和调试代码
>
> 这正是我们 AgentX 生态倡导的方式。

---

## 1.3.1 理解任务目标

### 我们要构建什么？

一个能处理分步任务的**智能旅行助手**，用户可以这样问它：

> "你好，请帮我查询一下今天北京的天气，然后根据天气推荐一个合适的旅游景点。"

### 智能体需要展现的能力

```
用户提问
    ↓
[1] 任务分解：识别出需要"查天气"和"推荐景点"两个步骤
    ↓
[2] 工具调用：调用天气 API 获取实时数据
    ↓
[3] 上下文传递：把天气结果作为下一步的输入
    ↓
[4] 再次调用：根据天气搜索合适的景点
    ↓
[5] 结果合成：整合信息，给出完整回答
```

---

## 1.3.2 智能体的核心组件

不管用什么语言实现，一个智能体都需要这几个核心组件：

### 组件一：系统提示词（System Prompt）

这是智能体的"说明书"，告诉 LLM 它是谁、能做什么、该怎么输出：

```
你是一个智能旅行助手。你的任务是分析用户的请求，并使用可用工具一步步地解决问题。

# 可用工具:
- get_weather(city): 查询指定城市的实时天气
- get_attraction(city, weather): 根据城市和天气推荐旅游景点

# 输出格式:
Thought: [你的思考过程]
Action: [要调用的工具，如 get_weather(city="北京")]

# 任务完成:
当收集到足够信息时，使用 finish(answer="...") 输出最终答案
```

### 组件二：工具函数（Tools）

智能体能调用的外部能力，比如：

| 工具 | 功能 | 输入 | 输出 |
|------|------|------|------|
| `get_weather` | 查询天气 | 城市名 | 天气描述 |
| `get_attraction` | 推荐景点 | 城市+天气 | 景点列表 |

### 组件三：主循环（Agent Loop）

```
while (任务未完成) {
    1. 把历史对话发给 LLM
    2. LLM 输出 Thought + Action
    3. 解析 Action，执行对应工具
    4. 把工具返回的 Observation 加入历史
    5. 检查是否调用了 finish()
}
```

---

## 1.3.3 用 TypeScript 实现（ES6+ 风格）

以下是一个用 TypeScript/ES6 实现的智能体示例。**你不需要手写这些代码**——理解结构后，可以让 AI 帮你生成：

### 工具定义

```typescript
// tools.ts - 智能体可调用的工具

interface Tool {
  name: string
  description: string
  execute: (params: Record<string, string>) => Promise<string>
}

// 天气查询工具
const getWeather: Tool = {
  name: 'get_weather',
  description: '查询指定城市的实时天气',
  execute: async ({ city }) => {
    const response = await fetch(`https://wttr.in/${city}?format=j1`)
    const data = await response.json()
    const condition = data.current_condition[0]
    return `${city}当前天气: ${condition.weatherDesc[0].value}，气温${condition.temp_C}°C`
  }
}

// 景点推荐工具
const getAttraction: Tool = {
  name: 'get_attraction',
  description: '根据城市和天气推荐旅游景点',
  execute: async ({ city, weather }) => {
    // 这里可以接入搜索 API，简化示例直接返回
    const suggestions = {
      'Sunny': '颐和园（适合户外赏景）、长城（天气晴好视野佳）',
      'Rainy': '国家博物馆（室内参观）、798艺术区（有遮蔽）',
      'default': '故宫博物院（四季皆宜）'
    }
    return suggestions[weather] || suggestions.default
  }
}

export const tools = new Map<string, Tool>([
  ['get_weather', getWeather],
  ['get_attraction', getAttraction]
])
```

### 智能体主循环

```typescript
// agent.ts - 智能体核心逻辑

import { tools } from './tools'

const SYSTEM_PROMPT = `
你是一个智能旅行助手。请使用可用工具一步步解决用户的问题。

## 可用工具
- get_weather(city): 查询城市天气
- get_attraction(city, weather): 推荐旅游景点

## 输出格式
每次只输出一对 Thought-Action：
Thought: [思考过程]
Action: [工具调用，如 get_weather(city="北京")]

## 完成任务
信息足够时使用: finish(answer="最终回答")
`

async function runAgent(userQuery: string) {
  const history: string[] = [`用户: ${userQuery}`]

  for (let i = 0; i < 5; i++) {  // 最多5轮
    console.log(`\n--- 循环 ${i + 1} ---`)

    // 1. 调用 LLM
    const llmResponse = await callLLM(history.join('\n'), SYSTEM_PROMPT)
    console.log('LLM:', llmResponse)
    history.push(llmResponse)

    // 2. 解析 Action
    const actionMatch = llmResponse.match(/Action:\s*(\w+)\((.+)\)/)
    if (!actionMatch) break

    const [, toolName, argsStr] = actionMatch

    // 3. 检查是否完成
    if (toolName === 'finish') {
      const answer = argsStr.match(/answer="(.+)"/)?.[1]
      console.log('\n✅ 任务完成:', answer)
      return answer
    }

    // 4. 执行工具
    const tool = tools.get(toolName)
    if (tool) {
      const params = Object.fromEntries(
        [...argsStr.matchAll(/(\w+)="([^"]+)"/g)].map(m => [m[1], m[2]])
      )
      const observation = await tool.execute(params)
      console.log('Observation:', observation)
      history.push(`Observation: ${observation}`)
    }
  }
}

// 使用示例
runAgent('帮我查一下北京的天气，然后推荐一个景点')
```

---

## 1.3.4 运行效果演示

```bash
用户: 帮我查一下北京的天气，然后推荐一个景点

--- 循环 1 ---
LLM:
Thought: 用户想知道北京的天气和景点推荐。我先查询天气。
Action: get_weather(city="北京")

Observation: 北京当前天气: Sunny，气温26°C

--- 循环 2 ---
LLM:
Thought: 北京是晴天，气温适宜。现在根据天气推荐景点。
Action: get_attraction(city="北京", weather="Sunny")

Observation: 颐和园（适合户外赏景）、长城（天气晴好视野佳）

--- 循环 3 ---
LLM:
Thought: 已收集到天气和景点信息，可以回答用户了。
Action: finish(answer="北京今天天气晴朗，26°C，非常适合出游！推荐您去颐和园欣赏湖光山色，或者去长城感受壮丽景观。")

✅ 任务完成: 北京今天天气晴朗，26°C，非常适合出游！...
```

---

## 1.3.5 用 AI 辅助你构建智能体

### 🚀 实践建议：让 AI 帮你写代码

与其手敲每一行代码，不如这样做：

**Step 1**: 把上面的结构理解清楚

**Step 2**: 用自然语言告诉 AI 你的需求：

```
我想用 TypeScript 构建一个智能体，具备以下能力：
1. 可以查询天气（用 wttr.in API）
2. 可以推荐餐厅（用某某 API）
3. 使用 Thought-Action-Observation 循环
4. 接入 OpenAI API 作为大脑

请帮我生成代码框架。
```

**Step 3**: AI 会生成代码，你来审核和调整

**Step 4**: 遇到问题，继续问 AI

### 💡 这就是 "Chat is All You Need" 的含义

你不需要：
- ❌ 精通 TypeScript 语法细节
- ❌ 背诵各种 API 的参数
- ❌ 从零开始写每个函数

你需要：
- ✅ 理解智能体的工作原理
- ✅ 能清晰描述你的需求
- ✅ 会和 AI 协作调试

---

## 1.3.6 核心能力总结

通过这个例子，我们看到智能体的**四项基本能力**：

| 能力 | 体现 |
|------|------|
| **任务分解** | 将"查天气+推荐景点"拆成两个独立步骤 |
| **工具调用** | 正确选择并调用 `get_weather` 和 `get_attraction` |
| **上下文传递** | 把天气结果作为参数传给下一步 |
| **结果合成** | 整合所有信息，生成自然语言回答 |

这四项能力的组合，让智能体能够将模糊的用户意图，转化为具体、可执行的步骤，最终达成目标。

---

## 本节小结

本节我们学习了：

1. **智能体的三个核心组件**：System Prompt、Tools、Agent Loop
2. **Thought-Action-Observation 循环**的实际运作方式
3. **TypeScript/ES6 实现**的代码结构（理解即可，让 AI 帮你写）
4. **Chat is All You Need** 的实践理念

> 🎯 **下一步**：在后续章节中，我们将介绍 AgentX 框架，它把这些组件封装好了，让你用更简单的方式构建智能体。

---

[⬅️ 上一节：智能体如何工作](1.2-智能体如何工作.md) | [🏠 返回目录](README.md) | [➡️ 下一节：智能体应用生态](1.4-智能体应用生态.md)
